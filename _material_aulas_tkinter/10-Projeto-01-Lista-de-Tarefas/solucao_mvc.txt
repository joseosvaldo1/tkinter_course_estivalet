import tkinter as tk
from tkinter import messagebox, PhotoImage, Toplevel

class TaskModel:
    def __init__(self):
        self.tasks = []

    def add_task(self, text, frame, label, var):
        self.tasks.append({"frame": frame, "text": text, "label": label, "var": var})

    def update_task(self, label, new_text):
        for task in self.tasks:
            if task["label"] == label:
                task["text"] = new_text
                break

    def delete_task(self, frame):
        self.tasks = [task for task in self.tasks if task["frame"] != frame]

class TaskView:
    def __init__(self, root, controller):
        self.root = root
        self.controller = controller
        self.root.title("Lista de Tarefas")
        self.root.geometry("520x400")
        self.root.configure(bg="#f4f4f4")
        self.load_images()
        self.create_widgets()

    def load_images(self):
        self.edit_icon = PhotoImage(file="edit.png")
        self.delete_icon = PhotoImage(file="delete.png")

    def create_widgets(self):
        entry_bg = "#ffffff"
        btn_bg = "#4285F4"
        btn_fg = "#ffffff"

        self.title_label = tk.Label(self.root, text="Lista de Tarefas", font=("Arial", 16, "bold"), bg="#f4f4f4")
        self.title_label.pack(pady=10)

        self.input_frame = tk.Frame(self.root, bg="#f4f4f4")
        self.input_frame.pack(pady=5, fill=tk.X, padx=10)

        self.task_entry = tk.Entry(self.input_frame, width=30, font=("Arial", 12), bg=entry_bg)
        self.task_entry.pack(side=tk.LEFT, padx=5, ipady=5, expand=True, fill=tk.X)

        self.add_button = tk.Button(self.input_frame, text="Adicionar Tarefa", command=self.controller.add_task,
                                    bg=btn_bg, fg=btn_fg, font=("Arial", 10, "bold"), padx=10, pady=5)
        self.add_button.pack(side=tk.LEFT)

        self.task_frame = tk.Frame(self.root, bg="#f4f4f4")
        self.task_frame.pack(pady=10, fill=tk.BOTH, expand=True, padx=10)

        self.task_canvas = tk.Canvas(self.task_frame, bg="#f4f4f4", highlightthickness=0)
        self.task_scrollbar = tk.Scrollbar(self.task_frame, orient=tk.VERTICAL, command=self.task_canvas.yview)
        self.task_list = tk.Frame(self.task_canvas, bg="#f4f4f4")

        self.task_list.bind("<Configure>", lambda e: self.task_canvas.configure(scrollregion=self.task_canvas.bbox("all")))
        self.task_canvas.create_window((0, 0), window=self.task_list, anchor="nw", width=480)
        self.task_canvas.configure(yscrollcommand=self.task_scrollbar.set)

        self.task_canvas.pack(side=tk.LEFT, fill=tk.BOTH, expand=True)
        self.task_scrollbar.pack(side=tk.RIGHT, fill=tk.Y)

    def add_task_to_view(self, task_text):
        task_var = tk.BooleanVar()
        task_frame = tk.Frame(self.task_list, bg="#ffffff", bd=1, relief=tk.RIDGE)

        task_checkbox = tk.Checkbutton(task_frame, variable=task_var, command=lambda: self.controller.toggle_task(task_checkbox, task_label, task_var), bg="#ffffff")
        task_checkbox.pack(side=tk.LEFT, padx=5)

        task_label = tk.Label(task_frame, text=task_text, width=30, anchor="w", font=("Arial", 12), bg="#ffffff")
        task_label.pack(side=tk.LEFT, padx=5, expand=True, fill=tk.X)

        edit_button = tk.Button(task_frame, image=self.edit_icon, command=lambda: self.controller.open_edit_window(task_label), bd=0, bg="#ffffff")
        edit_button.pack(side=tk.LEFT, padx=5)

        delete_button = tk.Button(task_frame, image=self.delete_icon, command=lambda: self.controller.delete_task(task_frame), bd=0, bg="#ffffff")
        delete_button.pack(side=tk.LEFT, padx=5)

        task_frame.pack(fill=tk.X, pady=2)
        return task_frame, task_label, task_var

class TaskController:
    def __init__(self, root):
        self.model = TaskModel()
        self.view = TaskView(root, self)

    def add_task(self):
        task_text = self.view.task_entry.get().strip()
        if not task_text:
            messagebox.showerror("Erro", "O campo de tarefa não pode estar vazio!")
            return
        task_frame, task_label, task_var = self.view.add_task_to_view(task_text)
        self.model.add_task(task_text, task_frame, task_label, task_var)
        self.view.task_entry.delete(0, tk.END)

    def toggle_task(self, checkbox, label, var):
        if var.get():
            label.config(font=("Arial", 12, "overstrike"), fg="gray")
        else:
            label.config(font=("Arial", 12), fg="black")

    def open_edit_window(self, label):
        edit_window = Toplevel(self.view.root)
        edit_window.title("Editar Tarefa")
        edit_window.geometry("300x150")
        edit_window.configure(bg="#f4f4f4")
        edit_window.resizable(False, False)

        tk.Label(edit_window, text="Edite a Tarefa:", font=("Arial", 12, "bold"), bg="#f4f4f4").pack(pady=10)

        task_edit_entry = tk.Entry(edit_window, font=("Arial", 12), width=30)
        task_edit_entry.pack(pady=5)
        task_edit_entry.insert(0, label.cget("text"))

        button_frame = tk.Frame(edit_window, bg="#f4f4f4")
        button_frame.pack(pady=10)

        save_button = tk.Button(button_frame, text="Salvar", bg="#34A853", fg="white", font=("Arial", 10, "bold"), command=lambda: self.save_task_edit(label, task_edit_entry.get(), edit_window))
        save_button.pack(side=tk.LEFT, padx=5)

        cancel_button = tk.Button(button_frame, text="Cancelar", bg="#EA4335", fg="white", font=("Arial", 10, "bold"), command=edit_window.destroy)
        cancel_button.pack(side=tk.LEFT, padx=5)

    def save_task_edit(self, label, new_text, edit_window):
        if new_text.strip():
            self.model.update_task(label, new_text.strip())
            label.config(text=new_text.strip())
            edit_window.destroy()
        else:
            messagebox.showerror("Erro", "O campo não pode estar vazio!")

    def delete_task(self, frame):
        self.model.delete_task(frame)
        frame.destroy()

if __name__ == "__main__":
    root = tk.Tk()
    app = TaskController(root)
    root.mainloop()
